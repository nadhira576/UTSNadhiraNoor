<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portal Manajemen Event — Pastel (Modal + Dark/Light)</title>
  <style>
    :root{
      --primary:#A3D5FF;        /* biru pastel */
      --primary-strong:#6CB4EE; /* biru aksen */
      --bg:#F6F8FB;             /* latar lembut */
      --card:#FFFFFF;
      --text:#2E3A59;
      --muted:#7B8BA1;
      --soft:#EAF4FF;
      --table-header:#A3D5FF;
      --shadow:0 10px 22px rgba(25,42,70,.08);
      --overlay:rgba(15,18,25,.45);
    }
    /* Dark Mode */
    :root.dark{
      --primary:#2b3a4b;
      --primary-strong:#4a6fa3;
      --bg:#1c1f26;
      --card:#2a2f38;
      --text:#f0f0f0;
      --muted:#b0b3b8;
      --soft:#343a45;
      --table-header:#4a6fa3;
      --shadow:0 10px 22px rgba(0,0,0,.35);
      --overlay:rgba(0,0,0,.6);
    }

    *{box-sizing:border-box; transition:background-color .25s,color .25s,border-color .25s}
    body{margin:0;background:var(--bg);font-family:"Segoe UI",Arial,sans-serif;color:var(--text)}

    /* ===== Header tidy (grid) ===== */
    header{
      background:var(--primary);
      padding:16px 16px 14px;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
    }
    .header-bar{
      max-width:1000px; margin:0 auto;
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:12px;
    }
    .brand{grid-column:2; justify-self:center; margin:0; font-weight:800; font-size:26px; letter-spacing:.3px}
    .toggle-mode{
      grid-column:3; justify-self:end;
      background:var(--primary-strong); color:#fff; border:0; border-radius:10px;
      padding:8px 12px; cursor:pointer; font-size:13px;
    }
    .ident{
      max-width:1000px; margin:6px auto 0;
      text-align:center; font-size:14px; color:#20314f;
    }
    :root.dark .ident{color:#d4d8de}

    /* ===== Kartu utama ===== */
    .card{max-width:1000px;margin:22px auto;background:var(--card);border-radius:14px;box-shadow:var(--shadow);padding:22px}
    .card h2{margin:0 0 16px;text-align:center;font-size:20px}

    /* ===== Form grid ===== */
    .form-grid{
      display:grid; grid-template-columns:repeat(2, minmax(260px,1fr)); gap:14px;
    }
    @media (max-width:720px){ .form-grid{grid-template-columns:1fr} }

    label{display:block;font-weight:600;margin:0 0 6px}
    input[type="text"],input[type="date"],textarea{
      width:100%;padding:11px 12px;border:1px solid #dbe3ef;border-radius:10px;background:var(--soft);
      font-size:14px;outline:none;
    }
    textarea{resize:vertical;min-height:92px}
    input:focus,textarea:focus{border-color:var(--primary-strong);box-shadow:0 0 0 3px rgba(108,180,238,.15);background:#f9fcff}

    .actions{display:flex;gap:10px;justify-content:center;margin-top:6px}
    .btn{border:0;border-radius:10px;padding:12px 18px;cursor:pointer;font-weight:700;font-size:14px}
    .btn-primary{background:var(--primary-strong);color:#fff}
    .btn-primary:hover{filter:brightness(.95)}

    /* ===== Tabel ===== */
    .table-wrap{margin-top:18px;border-radius:12px;overflow:auto;border:1px solid #e8edf5}
    table{width:100%;border-collapse:collapse;min-width:720px}
    thead th{background:var(--table-header);color:#20314f;text-align:left;padding:12px 14px;font-weight:800;font-size:13px}
    :root.dark thead th{color:#fff}
    tbody td{padding:11px 14px;border-top:1px solid #edf2fa;font-size:14px}
    tbody tr:nth-child(even){background:#fbfdff}
    :root.dark tbody tr:nth-child(even){background:#2f3541}
    tbody a{color:var(--primary-strong);text-decoration:none}
    tbody a:hover{text-decoration:underline}

    .live-map{margin-top:18px;border:0;width:100%;height:340px;border-radius:12px;box-shadow:var(--shadow)}
    footer{padding:24px 14px 40px;text-align:center;color:var(--muted);font-size:13px}
    .error{color:#b42318;background:#fee4e2;border:1px solid #f7b0a7;padding:8px 10px;border-radius:8px;margin:8px 0;display:none;font-size:13px}

    /* ===== Modal (popup) ===== */
    .modal-overlay{
      position:fixed; inset:0; background:var(--overlay);
      display:none; align-items:center; justify-content:center; z-index:1000;
    }
    .modal{
      background:var(--card); color:var(--text);
      width:min(520px, 92vw);
      border-radius:14px; box-shadow:var(--shadow);
      padding:20px 18px;
      text-align:center;
      transform:translateY(10px); opacity:0; transition:opacity .2s, transform .2s;
    }
    .modal h3{margin:0 0 8px; font-size:18px}
    .modal p{margin:0 0 14px; color:var(--muted)}
    .modal .btn{min-width:120px}

    .modal-overlay.show{display:flex}
    .modal-overlay.show .modal{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <header>
    <div class="header-bar">
      <div></div><!-- spacer kiri -->
      <h1 class="brand">Portal Manajemen Event Desa</h1>
      <button class="toggle-mode" id="toggleMode">🌙 Mode Gelap</button>
    </div>
    <div class="ident"><strong>Nadhira Noor Rachma</strong> — <strong>2406355400</strong></div>
  </header>

  <section class="card" aria-label="Form Tambah Acara">
    <h2>Tambah Acara</h2>
    <div id="errorBox" class="error" role="alert"></div>

    <form id="eventForm" class="form-grid" novalidate>
      <div class="field">
        <label for="namaAcara">Nama Acara</label>
        <input id="namaAcara" type="text" placeholder="Contoh: UTS, Kerja Bakti RT 05" required>
      </div>
      <div class="field">
        <label for="tanggalAcara">Tanggal Acara</label>
        <input id="tanggalAcara" type="date" required>
      </div>
      <div class="field" style="grid-column:1 / -1;">
        <label for="deskripsiAcara">Deskripsi Acara</label>
        <textarea id="deskripsiAcara" placeholder="Tulis ringkas deskripsi acara..." required></textarea>
      </div>
      <div class="field" style="grid-column:1 / -1;">
        <label for="linkMaps">Lokasi (alamat / URL Google Maps / koordinat)</label>
        <input id="linkMaps" type="text" placeholder="Contoh: Balai Desa Sukamaju atau -6.1754,106.8272" required>
      </div>
      <div class="actions" style="grid-column:1 / -1;">
        <button type="submit" class="btn btn-primary" id="submitBtn">Tambahkan Acara</button>
        <button type="reset" class="btn btn-primary" style="background:#94c8f3">Reset</button>
      </div>
    </form>

    <h2 style="margin-top:18px">Daftar Acara</h2>
    <div class="table-wrap">
      <table aria-describedby="daftar-acara">
        <thead>
          <tr>
            <th style="width:64px">No</th>
            <th>Nama Acara</th>
            <th style="width:150px">Tanggal</th>
            <th>Deskripsi</th>
            <th style="width:160px">Lokasi</th>
          </tr>
        </thead>
        <tbody id="eventBody"></tbody>
      </table>
    </div>

    <iframe id="liveMap" class="live-map"
            src="https://www.google.com/maps?q=Monas%20Jakarta&output=embed"
            loading="lazy" allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"></iframe>
  </section>

  <!-- ===== Modal konfirmasi ===== -->
  <div class="modal-overlay" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Terima Kasih!</h3>
      <p>Daftar acara sudah tersimpan.</p>
      <button type="button" class="btn btn-primary" id="closeModal">Tutup</button>
    </div>
  </div>

  <footer>&copy; 2025 Portal Event Desa • Modal + Dark Mode</footer>

  <script>
    const form    = document.getElementById('eventForm');
    const tbody   = document.getElementById('eventBody');
    const liveMap = document.getElementById('liveMap');
    const errBox  = document.getElementById('errorBox');
    const toggle  = document.getElementById('toggleMode');
    const modal   = document.getElementById('modal');
    const closeMd = document.getElementById('closeModal');
    const submitBtn = document.getElementById('submitBtn');
    let counter  = 0;

    // Toggle dark/light + remember
    toggle.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark');
      toggle.textContent = document.documentElement.classList.contains('dark')
        ? '☀️ Mode Terang' : '🌙 Mode Gelap';
      localStorage.setItem('prefers-dark', document.documentElement.classList.contains('dark') ? '1':'0');
    });
    (function(){
      if(localStorage.getItem('prefers-dark') === '1'){
        document.documentElement.classList.add('dark');
        toggle.textContent = '☀️ Mode Terang';
      }
    })();

    // Min date H+1
    (function setMinDate(){
      const tgl = document.getElementById('tanggalAcara');
      const d = new Date(); d.setDate(d.getDate()+1);
      tgl.min = d.toISOString().split('T')[0];
    })();

    function showError(msg){errBox.textContent=msg;errBox.style.display='block'}
    function clearError(){errBox.textContent='';errBox.style.display='none'}

    // Parser lokasi -> embed & view
    function toEmbedSrc(raw){
      if(!raw) return "";
      const s = String(raw).trim();
      if(/\/embed/i.test(s)) return s;
      const qParam = /[?&]q=([^&]+)/i.exec(s);
      if(qParam) return `https://www.google.com/maps?q=${decodeURIComponent(qParam[1])}&output=embed`;
      const atCoord = /@(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/.exec(s);
      if(atCoord) return `https://www.google.com/maps?q=${atCoord[1]},${atCoord[2]}&output=embed`;
      const plainCoord = /(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/.exec(s);
      if(plainCoord) return `https://www.google.com/maps?q=${plainCoord[1]},${plainCoord[2]}&output=embed`;
      const place = /\/maps\/place\/([^/]+)/i.exec(s);
      if(place) return `https://www.google.com/maps?q=${decodeURIComponent(place[1].replace(/\+/g,' '))}&output=embed`;
      return `https://www.google.com/maps?q=${encodeURIComponent(s)}&output=embed`;
    }
    function toViewUrl(raw){
      if(!raw) return "";
      const s = String(raw).trim();
      const qParam = /[?&]q=([^&]+)/i.exec(s);
      if(qParam) return `https://www.google.com/maps/search/?api=1&query=${decodeURIComponent(qParam[1])}`;
      const atCoord = /@(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/.exec(s);
      if(atCoord) return `https://www.google.com/maps/search/?api=1&query=${atCoord[1]},${atCoord[2]}`;
      const plainCoord = /(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/.exec(s);
      if(plainCoord) return `https://www.google.com/maps/search/?api=1&query=${plainCoord[1]},${plainCoord[2]}`;
      const place = /\/maps\/place\/([^/]+)/i.exec(s);
      if(place) return `https://www.google.com/maps/search/?api=1&query=${decodeURIComponent(place[1].replace(/\+/g,' '))}`;
      if(/\/embed/i.test(s)){
        const innerQ = /[?&](?:q|query)=([^&]+)/i.exec(s);
        if(innerQ) return `https://www.google.com/maps/search/?api=1&query=${decodeURIComponent(innerQ[1])}`;
      }
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s)}`;
    }

    const escapeHtml = s => String(s)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;')
      .replace(/'/g,'&#039;');

    // ====== Modal helpers ======
    let modalTimer = null;
    function openModal(){
      modal.classList.add('show');
      closeMd.focus();
      // auto close after 2.5s
      modalTimer = setTimeout(closeModal, 2500);
    }
    function closeModal(){
      modal.classList.remove('show');
      if(modalTimer){ clearTimeout(modalTimer); modalTimer=null; }
      submitBtn.focus(); // kembali ke tombol submit
    }
    // close actions
    closeMd.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('show')) closeModal(); });

    // ====== Submit ======
    form.addEventListener('submit', e=>{
      e.preventDefault(); clearError();

      const nama = document.getElementById('namaAcara').value.trim();
      const tgl  = document.getElementById('tanggalAcara').value;
      const desk = document.getElementById('deskripsiAcara').value.trim();
      const loc  = document.getElementById('linkMaps').value.trim();

      if(!nama || !tgl || !desk || !loc){ showError('Harap isi semua kolom terlebih dahulu.'); return; }

      // Validasi H+1
      const sel = new Date(tgl); sel.setHours(0,0,0,0);
      const today = new Date(); today.setHours(0,0,0,0);
      const min = new Date(today); min.setDate(today.getDate()+1);
      if(sel < min){ showError('Tanggal acara minimal H+1 (mulai besok).'); return; }

      const embed = toEmbedSrc(loc);
      const view  = toViewUrl(loc);

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${++counter}</td>
        <td>${escapeHtml(nama)}</td>
        <td>${escapeHtml(tgl)}</td>
        <td>${escapeHtml(desk)}</td>
        <td><a href="${view}" target="_blank" rel="noopener">Lihat Lokasi</a></td>
      `;
      tbody.appendChild(row);
      liveMap.src = embed;

      // popup sukses
      openModal();

      // reset form + min date lagi
      form.reset();
      const t = document.getElementById('tanggalAcara');
      const d = new Date(); d.setDate(d.getDate()+1);
      t.min = d.toISOString().split('T')[0];
    });
  </script>
</body>
</html>

